<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bhavishyath - Dashboard</title>
  <link rel="icon" href="/bhavishyath_logo.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --primary-navy: #1e293b;
      --secondary-slate: #334155;
      --accent-indigo: #4f46e5;
      --success-teal: #14b8a6;
      --warning-amber: #f59e0b;
      --error-crimson: #dc2626;
      --bg-light: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --easy-green: #10b981;
      --medium-yellow: #f59e0b;
      --hard-red: #ef4444;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--bg-light);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header Navigation */
    .header {
      background-color: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-sm);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-navy);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo i {
      color: var(--accent-indigo);
    }

    .nav-buttons {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-btn {
      padding: 0.5rem 1.25rem;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-btn-primary {
      background-color: var(--accent-indigo);
      color: white;
    }

    .nav-btn-primary:hover {
      background-color: #4338ca;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .nav-btn-outline {
      background-color: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .nav-btn-outline:hover {
      background-color: var(--bg-light);
    }

    .nav-btn-danger {
      background-color: var(--error-crimson);
      color: white;
    }

    .nav-btn-danger:hover {
      background-color: #b91c1c;
    }

    /* Main Container */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Welcome Section */
    .welcome-section {
      margin-bottom: 2.5rem;
    }

    .welcome-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-navy);
      margin-bottom: 0.5rem;
    }

    .welcome-subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .stat-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.75rem;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-indigo), var(--success-teal));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .icon-primary {
      background-color: rgba(79, 70, 229, 0.1);
      color: var(--accent-indigo);
    }

    .icon-success {
      background-color: rgba(20, 184, 166, 0.1);
      color: var(--success-teal);
    }

    .icon-warning {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--warning-amber);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-navy);
      line-height: 1;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Streak Badge */
    .streak-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    /* Difficulty Breakdown Card */
    .difficulty-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: var(--shadow-sm);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-navy);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .card-title i {
      color: var(--accent-indigo);
    }

    .difficulty-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .difficulty-item {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .difficulty-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .difficulty-label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .label-easy { color: var(--easy-green); }
    .label-medium { color: var(--medium-yellow); }
    .label-hard { color: var(--hard-red); }

    .difficulty-count {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary-navy);
    }

    .progress-bar-container {
      width: 100%;
      height: 10px;
      background-color: var(--bg-light);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .fill-easy { background-color: var(--easy-green); }
    .fill-medium { background-color: var(--medium-yellow); }
    .fill-hard { background-color: var(--hard-red); }

    /* Circular Progress */
    .circular-progress {
      display: flex;
      justify-content: space-around;
      margin-top: 1.5rem;
    }

    .circle-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .circle-svg {
      width: 80px;
      height: 80px;
      transform: rotate(-90deg);
    }

    .circle-bg {
      fill: none;
      stroke: var(--bg-light);
      stroke-width: 8;
    }

    .circle-progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .circle-text {
      text-align: center;
    }

    .circle-count {
      font-weight: 700;
      font-size: 1rem;
      color: var(--primary-navy);
    }

    .circle-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    /* Activity Heatmap */
    .activity-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: var(--shadow-sm);
    }

    .heatmap-container {
      margin-top: 1.5rem;
      overflow-x: auto;
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(53, 12px);
      gap: 3px;
      min-width: 680px;
    }

    .heatmap-cell {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      background-color: var(--bg-light);
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }

    .heatmap-cell:hover {
      transform: scale(1.3);
      z-index: 10;
    }

    .cell-level-0 { background-color: #ebedf0; }
    .cell-level-1 { background-color: #9be9a8; }
    .cell-level-2 { background-color: #40c463; }
    .cell-level-3 { background-color: #30a14e; }
    .cell-level-4 { background-color: #216e39; }

    .heatmap-legend {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Problems Section */
    .problems-section {
      margin-top: 2.5rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-navy);
    }

    /* Search and Filter Section */
    .search-filter-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
    }

    .search-bar {
      display: flex;
      gap: 1rem;
      align-items: center;
      position: relative;
    }

    .search-input {
      flex: 1;
      padding: 0.75rem 1rem 0.75rem 2.75rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      background-color: var(--bg-light);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-indigo);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      background-color: var(--bg-card);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      color: var(--text-secondary);
      font-size: 1.1rem;
      pointer-events: none;
    }

    .clear-filters-btn {
      padding: 0.75rem 1.5rem;
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .clear-filters-btn:hover {
      background-color: var(--border-color);
    }

    .filter-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-select {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--bg-light);
      color: var(--text-primary);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 180px;
    }

    .filter-select:hover {
      border-color: var(--accent-indigo);
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--accent-indigo);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .active-filters {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .filter-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: rgba(79, 70, 229, 0.1);
      border: 1px solid rgba(79, 70, 229, 0.3);
      border-radius: 20px;
      color: var(--accent-indigo);
      font-weight: 600;
      font-size: 0.85rem;
    }

    .filter-tag i {
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .filter-tag i:hover {
      transform: scale(1.2);
    }

    .no-results {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .no-results i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .problems-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .problem-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.75rem;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .problem-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent-indigo);
    }

    .problem-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--primary-navy);
      margin-bottom: 0.75rem;
    }

    .problem-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 1.25rem;
      flex-grow: 1;
    }

    .problem-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .problem-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .status-solved {
      color: var(--success-teal);
      font-weight: 600;
    }

    .solve-btn {
      padding: 0.625rem 1.5rem;
      background-color: var(--accent-indigo);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .solve-btn:hover {
      background-color: #4338ca;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .solve-btn.solved {
      background-color: var(--success-teal);
    }

    .solve-btn.solved:hover {
      background-color: #0d9488;
    }

    /* Loading State */
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--border-color);
      border-top-color: var(--accent-indigo);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      background-color: var(--primary-navy);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      z-index: 1000;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .difficulty-card,
      .activity-card {
        max-width: 100%;
      }
    }

    @media (max-width: 768px) {
      .main-container {
        padding: 1rem;
      }

      .header-content {
        padding: 0 1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }

      .stat-card {
        padding: 1.25rem;
      }

      .stat-value {
        font-size: 2rem;
      }

      .difficulty-card,
      .activity-card {
        padding: 1.5rem;
        width: 100%;
        max-width: 100%;
      }
      
      .difficulty-list {
        max-width: 100%;
      }
      
      .circular-progress {
        flex-wrap: wrap;
        gap: 1rem;
      }

      .problems-grid {
        grid-template-columns: 1fr;
      }
      
      .heatmap-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0.5rem;
      }
      
      .heatmap-grid {
        min-width: 600px;
      }

      .nav-buttons {
        gap: 0.5rem;
      }

      .nav-btn span {
        display: none;
      }

      .welcome-title {
        font-size: 1.5rem;
      }

      .heatmap-grid {
        grid-template-columns: repeat(53, 10px);
        gap: 2px;
      }

      .heatmap-cell {
        width: 10px;
        height: 10px;
      }
    }

    @media (max-width: 480px) {
      .logo {
        font-size: 1.25rem;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .stat-icon {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }
      
      .difficulty-card,
      .activity-card {
        padding: 1rem;
      }
      
      .card-title {
        font-size: 1rem;
      }

      .circular-progress {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 1rem;
      }
      
      .circle-svg {
        width: 55px;
        height: 55px;
      }
      
      .circle-count {
        font-size: 0.9rem;
      }
      
      .circle-label {
        font-size: 0.75rem;
      }
      
      .heatmap-grid {
        min-width: 400px;
        grid-template-columns: repeat(53, 7px);
        gap: 1.5px;
      }
      
      .heatmap-cell {
        width: 7px;
        height: 7px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="user-dashboard.html" class="logo">
        <i class="bi bi-code-square"></i>
        Bhavishyath
      </a>
      <nav class="nav-buttons">
        <a href="user-dashboard.html" class="nav-btn nav-btn-outline">
          <i class="bi bi-grid-fill"></i>
          <span>Dashboard</span>
        </a>
        <a href="user-profile.html" class="nav-btn nav-btn-primary">
          <i class="bi bi-person-circle"></i>
          <span>Profile</span>
        </a>
        <a class="nav-btn nav-btn-primary" href="highlights.html">
    <i class="bi bi-star-fill"></i> Highlights
</a>
        <button id="logoutBtn" class="nav-btn nav-btn-danger">
          <i class="bi bi-box-arrow-right"></i>
          <span>Logout</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <h1 class="welcome-title">Welcome back, <span id="userName">Student</span>!</h1>
      <p class="welcome-subtitle">Track your progress and continue your coding journey</p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon icon-primary">
            <i class="bi bi-code-slash"></i>
          </div>
        </div>
        <div class="stat-value" id="totalSolved">0</div>
        <div class="stat-label">Total Solved</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon icon-success">
            <i class="bi bi-fire"></i>
          </div>
        </div>
        <div class="stat-value" id="currentStreak">0</div>
        <div class="stat-label">Day Streak</div>
        <div class="streak-badge">
          <i class="bi bi-lightning-charge-fill"></i>
          Keep it going!
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon icon-warning">
            <i class="bi bi-trophy-fill"></i>
          </div>
        </div>
        <div class="stat-value" id="accuracyRate">0%</div>
        <div class="stat-label">Accuracy Rate</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon icon-primary">
            <i class="bi bi-calendar-check"></i>
          </div>
        </div>
        <div class="stat-value" id="activeDays">0</div>
        <div class="stat-label">Active Days</div>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Difficulty Breakdown -->
      <div class="difficulty-card">
        <h3 class="card-title">
          <i class="bi bi-bar-chart-fill"></i>
          Problem Difficulty Breakdown
        </h3>
        
        <div class="difficulty-list">
          <div class="difficulty-item">
            <div class="difficulty-header">
              <span class="difficulty-label label-easy">Easy</span>
              <span class="difficulty-count"><span id="easySolved">0</span> / <span id="easyTotal">0</span></span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill fill-easy" id="easyProgress" style="width: 0%"></div>
            </div>
          </div>

          <div class="difficulty-item">
            <div class="difficulty-header">
              <span class="difficulty-label label-medium">Medium</span>
              <span class="difficulty-count"><span id="mediumSolved">0</span> / <span id="mediumTotal">0</span></span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill fill-medium" id="mediumProgress" style="width: 0%"></div>
            </div>
          </div>

          <div class="difficulty-item">
            <div class="difficulty-header">
              <span class="difficulty-label label-hard">Hard</span>
              <span class="difficulty-count"><span id="hardSolved">0</span> / <span id="hardTotal">0</span></span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill fill-hard" id="hardProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Circular Progress -->
        <div class="circular-progress">
          <div class="circle-item">
            <svg class="circle-svg" viewBox="0 0 100 100">
              <circle class="circle-bg" cx="50" cy="50" r="40"></circle>
              <circle class="circle-progress" cx="50" cy="50" r="40" 
                      stroke="var(--easy-green)" 
                      id="easyCircle"
                      stroke-dasharray="251.2" 
                      stroke-dashoffset="251.2"></circle>
            </svg>
            <div class="circle-text">
              <div class="circle-count" id="easyPercent">0%</div>
              <div class="circle-label">Easy</div>
            </div>
          </div>

          <div class="circle-item">
            <svg class="circle-svg" viewBox="0 0 100 100">
              <circle class="circle-bg" cx="50" cy="50" r="40"></circle>
              <circle class="circle-progress" cx="50" cy="50" r="40" 
                      stroke="var(--medium-yellow)" 
                      id="mediumCircle"
                      stroke-dasharray="251.2" 
                      stroke-dashoffset="251.2"></circle>
            </svg>
            <div class="circle-text">
              <div class="circle-count" id="mediumPercent">0%</div>
              <div class="circle-label">Medium</div>
            </div>
          </div>

          <div class="circle-item">
            <svg class="circle-svg" viewBox="0 0 100 100">
              <circle class="circle-bg" cx="50" cy="50" r="40"></circle>
              <circle class="circle-progress" cx="50" cy="50" r="40" 
                      stroke="var(--hard-red)" 
                      id="hardCircle"
                      stroke-dasharray="251.2" 
                      stroke-dashoffset="251.2"></circle>
            </svg>
            <div class="circle-text">
              <div class="circle-count" id="hardPercent">0%</div>
              <div class="circle-label">Hard</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Heatmap -->
      <div class="activity-card">
        <h3 class="card-title">
          <i class="bi bi-activity"></i>
          Activity
        </h3>
        <div class="heatmap-container">
          <div class="heatmap-grid" id="heatmapGrid">
            <!-- Generated dynamically -->
          </div>
          <div class="heatmap-legend">
            <span>Less</span>
            <div class="legend-item">
              <div class="heatmap-cell cell-level-0"></div>
              <div class="heatmap-cell cell-level-1"></div>
              <div class="heatmap-cell cell-level-2"></div>
              <div class="heatmap-cell cell-level-3"></div>
              <div class="heatmap-cell cell-level-4"></div>
            </div>
            <span>More</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Problems Section -->
    <div class="problems-section">
      <div class="section-header">
        <h2 class="section-title">Practice Problems</h2>
      </div>

      <!-- Search and Filter Container -->
      <div class="search-filter-container">
        <div class="search-bar">
          <i class="bi bi-search search-icon"></i>
          <input 
            type="text" 
            id="searchInput" 
            class="search-input" 
            placeholder="Search problems by title or description..."
          >
          <button class="clear-filters-btn" id="clearFiltersBtn">
            <i class="bi bi-x-lg"></i> Clear Filters
          </button>
        </div>

        <div class="filter-group">
          <label class="filter-label">Filter By:</label>
          <select id="languageFilter" class="filter-select">
            <option value="">All Languages</option>
            <option value="1">C++</option>
            <option value="2">Java</option>
            <option value="3">Python</option>
            <option value="4">C</option>
            <option value="5">JavaScript</option>
          </select>

          <select id="difficultyFilter" class="filter-select">
            <option value="">All Difficulty Levels</option>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>

          <div class="active-filters" id="activeFilters"></div>
        </div>
      </div>

      <div id="programList" class="problems-grid">
        <!-- Loading state -->
        <div class="loading-container">
          <div class="spinner"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      "https://cfajcmbhspradnvofbgb.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmYWpjbWJoc3ByYWRudm9mYmdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDI0MDQsImV4cCI6MjA2OTg3ODQwNH0.mlq67ZmdeE_3_sPXY17JLd9xJ8KGDnR3eiJ9LoO9NUE"
    );

    const userId = localStorage.getItem("user_id");

    // Redirect if not logged in
    if (!userId) {
      window.location.href = "user-login.html";
    }

    let userSubmissions = [];
    let allProblems = [];
    let filteredProblems = [];

    // Filter state
    let filters = {
      search: '',
      language: '',
      difficulty: ''
    };

    // Load user profile
    async function loadUserProfile() {
      try {
        const { data, error } = await supabase
          .from('users')
          .select('full_name, email')
          .eq('id', userId)
          .single();

        if (!error && data) {
          const displayName = data.full_name || data.email.split('@')[0];
          document.getElementById('userName').textContent = displayName;
        }
      } catch (err) {
        console.error('Error loading user profile:', err);
      }
    }

    // Load all submissions for analytics
    async function loadSubmissions() {
      try {
        const { data, error } = await supabase
          .from('submissions')
          .select('*')
          .eq('user_id', userId)
          .order('submitted_at', { ascending: false });

        if (!error && data) {
          userSubmissions = data;
          calculateStats();
          generateActivityHeatmap();
        }
      } catch (err) {
        console.error('Error loading submissions:', err);
      }
    }

    // Calculate statistics
    function calculateStats() {
      // Total solved (unique correct submissions)
      const solvedProblems = new Set(
        userSubmissions
          .filter(s => s.is_correct)
          .map(s => s.program_id)
      );
      const totalSolved = solvedProblems.size;
      document.getElementById('totalSolved').textContent = totalSolved;

      // Calculate streak
      const streak = calculateStreak();
      document.getElementById('currentStreak').textContent = streak;

      // Calculate accuracy
      const totalAttempts = userSubmissions.length;
      const correctAttempts = userSubmissions.filter(s => s.is_correct).length;
      const accuracy = totalAttempts > 0 ? Math.round((correctAttempts / totalAttempts) * 100) : 0;
      document.getElementById('accuracyRate').textContent = accuracy + '%';

      // Calculate active days
      const activeDays = new Set(
        userSubmissions.map(s => new Date(s.submitted_at).toDateString())
      ).size;
      document.getElementById('activeDays').textContent = activeDays;

      // Animate stat cards
      animateValue('totalSolved', 0, totalSolved, 800);
      animateValue('currentStreak', 0, streak, 800);
      animateValue('activeDays', 0, activeDays, 800);
    }

    // Calculate streak
    function calculateStreak() {
      if (userSubmissions.length === 0) return 0;

      const dates = userSubmissions
        .map(s => new Date(s.submitted_at).toDateString())
        .filter((value, index, self) => self.indexOf(value) === index)
        .sort((a, b) => new Date(b) - new Date(a));

      let streak = 0;
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();

      // Check if active today or yesterday
      if (dates[0] !== today && dates[0] !== yesterday) {
        return 0;
      }

      let currentDate = new Date();
      for (let i = 0; i < dates.length; i++) {
        const dateStr = new Date(currentDate).toDateString();
        if (dates.includes(dateStr)) {
          streak++;
          currentDate.setDate(currentDate.getDate() - 1);
        } else {
          break;
        }
      }

      return streak;
    }

    // Generate activity heatmap (last 365 days)
    function generateActivityHeatmap() {
      const heatmapGrid = document.getElementById('heatmapGrid');
      heatmapGrid.innerHTML = '';

      // Create activity map
      const activityMap = {};
      userSubmissions.forEach(s => {
        const date = new Date(s.submitted_at).toDateString();
        activityMap[date] = (activityMap[date] || 0) + 1;
      });

      // Generate cells for last 371 days (53 weeks)
      const today = new Date();
      for (let i = 370; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        const count = activityMap[dateStr] || 0;

        const cell = document.createElement('div');
        cell.className = 'heatmap-cell';
        
        // Determine level (0-4)
        let level = 0;
        if (count > 0) level = 1;
        if (count >= 3) level = 2;
        if (count >= 5) level = 3;
        if (count >= 8) level = 4;

        cell.classList.add(`cell-level-${level}`);
        cell.setAttribute('data-date', dateStr);
        cell.setAttribute('data-count', count);
        cell.title = `${dateStr}: ${count} submission${count !== 1 ? 's' : ''}`;

        heatmapGrid.appendChild(cell);
      }
    }

    // Load problems and calculate difficulty breakdown
    async function loadProblems() {
      try {
        const { data, error } = await supabase.from("programs").select("*");
        if (error) {
          console.error('Error loading programs:', error);
          return;
        }

        allProblems = data || [];
        calculateDifficultyBreakdown();
        applyFilters();
      } catch (err) {
        console.error('Error:', err);
      }
    }

    // Calculate difficulty breakdown
    function calculateDifficultyBreakdown() {
      // Note: You'll need to add a 'difficulty' field to your programs table
      // For now, we'll simulate it based on language_id or you can add it manually
      const easyProblems = allProblems.filter(p => (p.difficulty || 'medium').toLowerCase() === 'easy');
      const mediumProblems = allProblems.filter(p => (p.difficulty || 'medium').toLowerCase() === 'medium');
      const hardProblems = allProblems.filter(p => (p.difficulty || 'medium').toLowerCase() === 'hard');

      const solvedProblems = new Set(
        userSubmissions.filter(s => s.is_correct).map(s => s.program_id)
      );

      const easySolved = easyProblems.filter(p => solvedProblems.has(p.id)).length;
      const mediumSolved = mediumProblems.filter(p => solvedProblems.has(p.id)).length;
      const hardSolved = hardProblems.filter(p => solvedProblems.has(p.id)).length;

      // Update UI
      updateDifficultyUI('easy', easySolved, easyProblems.length);
      updateDifficultyUI('medium', mediumSolved, mediumProblems.length);
      updateDifficultyUI('hard', hardSolved, hardProblems.length);
    }

    // Update difficulty UI
    function updateDifficultyUI(difficulty, solved, total) {
      const percentage = total > 0 ? Math.round((solved / total) * 100) : 0;
      
      // Update counts
      document.getElementById(`${difficulty}Solved`).textContent = solved;
      document.getElementById(`${difficulty}Total`).textContent = total;
      
      // Update progress bar
      const progressBar = document.getElementById(`${difficulty}Progress`);
      setTimeout(() => {
        progressBar.style.width = percentage + '%';
      }, 100);

      // Update circular progress
      const circle = document.getElementById(`${difficulty}Circle`);
      const circumference = 251.2;
      const offset = circumference - (percentage / 100) * circumference;
      setTimeout(() => {
        circle.style.strokeDashoffset = offset;
      }, 100);

      // Update percentage text
      document.getElementById(`${difficulty}Percent`).textContent = percentage + '%';
    }

    // Apply filters and search
    function applyFilters() {
      filteredProblems = allProblems.filter(problem => {
        // Search filter - search by title, description, and language
        const searchTerm = filters.search.toLowerCase();
        const langNames = { 1: 'c++', 2: 'java', 3: 'python' , 4: 'c', 5: 'javascript' };
        const langName = langNames[problem.language_id] || '';
        
        const matchesSearch = !searchTerm || 
          problem.title.toLowerCase().includes(searchTerm) || 
          problem.description.toLowerCase().includes(searchTerm) ||
          langName.includes(searchTerm);

        // Language filter
        const matchesLanguage = !filters.language || problem.language_id.toString() === filters.language;

        // Difficulty filter
        const problemDifficulty = (problem.difficulty || 'medium').toLowerCase();
        const matchesDifficulty = !filters.difficulty || problemDifficulty === filters.difficulty.toLowerCase();

        return matchesSearch && matchesLanguage && matchesDifficulty;
      });

      renderProblems();
      updateActiveFilters();
    }

    // Update active filters display
    function updateActiveFilters() {
      const activeFiltersDiv = document.getElementById('activeFilters');
      const filterTags = [];

      if (filters.search) {
        filterTags.push(`<div class="filter-tag">üîç Search: "${filters.search}" <i class="bi bi-x" onclick="removeFilter('search')"></i></div>`);
      }

      if (filters.language) {
        const langNames = { '1': 'C++', '2': 'Java', '3': 'Python', '4': 'C', '5': 'JavaScript' };
        filterTags.push(`<div class="filter-tag">${langNames[filters.language]} <i class="bi bi-x" onclick="removeFilter('language')"></i></div>`);
      }

      if (filters.difficulty) {
        const diffLabel = filters.difficulty.charAt(0).toUpperCase() + filters.difficulty.slice(1);
        filterTags.push(`<div class="filter-tag">${diffLabel} <i class="bi bi-x" onclick="removeFilter('difficulty')"></i></div>`);
      }

      activeFiltersDiv.innerHTML = filterTags.join('');
    }

    // Remove individual filter
    window.removeFilter = function(filterType) {
      filters[filterType] = '';
      document.getElementById('searchInput').value = '';
      document.getElementById('languageFilter').value = '';
      document.getElementById('difficultyFilter').value = '';
      applyFilters();
    };

    // Render problems
    function renderProblems() {
      const programList = document.getElementById('programList');
      
      if (filteredProblems.length === 0) {
        if (allProblems.length === 0) {
          programList.innerHTML = '<div class="no-results"><i class="bi bi-inbox"></i><p>No problems available yet.</p></div>';
        } else {
          programList.innerHTML = '<div class="no-results"><i class="bi bi-search"></i><p>No problems match your search or filters.</p></div>';
        }
        return;
      }

      const solvedProblems = new Set(
        userSubmissions.filter(s => s.is_correct).map(s => s.program_id)
      );

      programList.innerHTML = filteredProblems.map(p => {
        const isSolved = solvedProblems.has(p.id);
        const difficultyLabel = (p.difficulty || 'medium').charAt(0).toUpperCase() + (p.difficulty || 'medium').slice(1);
        const langNames = { 1: 'C++', 2: 'Java', 3: 'Python', 4: 'C', 5: 'JavaScript' };
        const langName = langNames[p.language_id] || 'Unknown';

        return `
          <div class="problem-card">
            <div class="problem-title">${p.title}</div>
            <div class="problem-description">${p.description}</div>
            <div style="display: flex; gap: 0.75rem; margin: 1rem 0; flex-wrap: wrap;">
              <span style="display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.35rem 0.75rem; background-color: rgba(79, 70, 229, 0.1); color: var(--accent-indigo); border-radius: 4px; font-size: 0.8rem; font-weight: 600;">
                <i class="bi bi-code-square"></i> ${langName}
              </span>
              <span style="display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.35rem 0.75rem; background-color: rgba(${getDifficultyRGB(p.difficulty)}, 0.1); color: var(--${getDifficultyColor(p.difficulty)}); border-radius: 4px; font-size: 0.8rem; font-weight: 600;">
                <i class="bi bi-lightning-fill"></i> ${difficultyLabel}
              </span>
            </div>
            <div class="problem-footer">
              <div class="problem-status ${isSolved ? 'status-solved' : ''}">
                ${isSolved ? '<i class="bi bi-check-circle-fill"></i> Solved' : '<i class="bi bi-circle"></i> Not attempted'}
              </div>
              <button class="solve-btn ${isSolved ? 'solved' : ''}" 
                      onclick="window.location.href='compiler.html?id=${p.id}'">
                ${isSolved ? '<i class="bi bi-arrow-repeat"></i> Retry' : '<i class="bi bi-play-fill"></i> Solve'}
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Helper function for difficulty color
    function getDifficultyColor(difficulty) {
      const colors = {
        'easy': 'easy-green',
        'medium': 'medium-yellow',
        'hard': 'hard-red'
      };
      return colors[difficulty] || 'medium-yellow';
    }

    // Helper function for difficulty RGB (for background)
    function getDifficultyRGB(difficulty) {
      const rgbs = {
        'easy': '16, 185, 129',
        'medium': '245, 158, 11',
        'hard': '239, 68, 68'
      };
      return rgbs[difficulty] || '245, 158, 11';
    }

    // Animate number values
    function animateValue(id, start, end, duration) {
      const element = document.getElementById(id);
      if (!element) return;

      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;

      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
        }
        
        const displayValue = Math.round(current);
        if (id === 'accuracyRate') {
          element.textContent = displayValue + '%';
        } else {
          element.textContent = displayValue;
        }
      }, 16);
    }

    // Logout functionality
    document.getElementById("logoutBtn").onclick = async () => {
      await supabase.auth.signOut();
      localStorage.clear();
      window.location.href = "user-login.html";
    };

    // Search and filter event listeners
    document.getElementById('searchInput').addEventListener('input', (e) => {
      filters.search = e.target.value;
      applyFilters();
    });

    document.getElementById('languageFilter').addEventListener('change', (e) => {
      filters.language = e.target.value;
      applyFilters();
    });

    document.getElementById('difficultyFilter').addEventListener('change', (e) => {
      filters.difficulty = e.target.value;
      applyFilters();
    });

    document.getElementById('clearFiltersBtn').addEventListener('click', () => {
      filters = { search: '', language: '', difficulty: '' };
      document.getElementById('searchInput').value = '';
      document.getElementById('languageFilter').value = '';
      document.getElementById('difficultyFilter').value = '';
      applyFilters();
    });

    // Initialize dashboard
    async function initDashboard() {
      await loadUserProfile();
      await loadSubmissions();
      await loadProblems();
    }

    initDashboard();
  </script>
</body>
</html>
